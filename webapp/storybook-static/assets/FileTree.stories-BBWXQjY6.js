import{j as L}from"./jsx-runtime-D_zvdyIk.js";import{r as E,g as G}from"./index-D4lIrffr.js";function J(e,t){return typeof e=="function"?e(t):e}function _(e,t){return n=>{t.setState(s=>Object.assign(Object.assign({},s),{[e]:J(n,s[e])}))}}const H=(e,t=100,n=1e3)=>new Promise(s=>{let i;const o=setInterval(()=>{e()&&(s(),clearInterval(o),clearTimeout(i))},t);i=setTimeout(()=>{clearInterval(o)},n)}),q="Headless Tree: ",j=e=>Error(q+e),Q=e=>console.warn(q+e);var N=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function d(c){try{f(s.next(c))}catch(g){a(g)}}function m(c){try{f(s.throw(c))}catch(g){a(g)}}function f(c){c.done?o(c.value):i(c.value).then(d,m)}f((s=s.apply(e,t||[])).next())})};const X={key:"tree",getInitialState:e=>Object.assign({expandedItems:[],focusedItem:null},e),getDefaultConfig:(e,t)=>Object.assign({setExpandedItems:_("expandedItems",t),setFocusedItem:_("focusedItem",t)},e),stateHandlerNames:{expandedItems:"setExpandedItems",focusedItem:"setFocusedItem"},treeInstance:{getItemsMeta:({tree:e})=>{const{rootItemId:t}=e.getConfig(),{expandedItems:n}=e.getState(),s=[],i=new Set(n),o=(m,f,c,g,x)=>{var v;if(f.includes(m)){Q(`Circular reference for ${f.join(".")}`);return}if(s.push({itemId:m,level:c,index:s.length,parentId:f.at(-1),setSize:g,posInSet:x}),i.has(m)){const h=(v=e.retrieveChildrenIds(m))!==null&&v!==void 0?v:[];let S=0;for(const b of h)o(b,f.concat(m),c+1,h.length,S++)}},a=e.retrieveChildrenIds(t);let d=0;for(const m of a)o(m,[t],0,a.length,d++);return s},getFocusedItem:({tree:e})=>{var t,n;return(n=e.getItemInstance((t=e.getState().focusedItem)!==null&&t!==void 0?t:""))!==null&&n!==void 0?n:e.getItems()[0]},focusNextItem:({tree:e})=>{var t;const n=e.getFocusedItem().getItemMeta();if(!n)return;const s=Math.min(n.index+1,e.getItems().length-1);(t=e.getItems()[s])===null||t===void 0||t.setFocused()},focusPreviousItem:({tree:e})=>{var t;const n=e.getFocusedItem().getItemMeta();if(!n)return;const s=Math.max(n.index-1,0);(t=e.getItems()[s])===null||t===void 0||t.setFocused()},updateDomFocus:({tree:e})=>{setTimeout(()=>N(void 0,void 0,void 0,function*(){var t,n;const s=e.getFocusedItem();(n=(t=e.getConfig()).scrollToItem)===null||n===void 0||n.call(t,s),yield H(()=>s.getElement()!==null,20);const i=s.getElement();i&&i.focus()}))},getContainerProps:({prev:e,tree:t},n)=>Object.assign(Object.assign({},e==null?void 0:e()),{role:"tree","aria-label":n??"",ref:t.registerElement}),isSearchOpen:()=>!1},itemInstance:{scrollTo:(e,t)=>N(void 0,[e,t],void 0,function*({tree:n,item:s},i){var o,a,d;(a=(o=n.getConfig()).scrollToItem)===null||a===void 0||a.call(o,s),yield H(()=>s.getElement()!==null,20),(d=s.getElement())===null||d===void 0||d.scrollIntoView(i)}),getId:({itemId:e})=>e,getProps:({item:e,prev:t})=>{const n=e.getItemMeta();return Object.assign(Object.assign({},t==null?void 0:t()),{ref:e.registerElement,role:"treeitem","aria-setsize":n.setSize,"aria-posinset":n.posInSet,"aria-selected":"false","aria-label":e.getItemName(),"aria-level":n.level,tabIndex:e.isFocused()?0:-1,onClick:s=>{e.setFocused(),e.primaryAction(),!(s.ctrlKey||s.shiftKey||s.metaKey)&&e.isFolder()&&(e.isExpanded()?e.collapse():e.expand())}})},expand:({tree:e,item:t,itemId:n})=>{var s;t.isFolder()&&(!((s=e.getState().loadingItemChildrens)===null||s===void 0)&&s.includes(n)||(e.applySubStateUpdate("expandedItems",i=>[...i,n]),e.rebuildTree()))},collapse:({tree:e,item:t,itemId:n})=>{t.isFolder()&&(e.applySubStateUpdate("expandedItems",s=>s.filter(i=>i!==n)),e.rebuildTree())},getItemData:({tree:e,itemId:t})=>e.retrieveItemData(t),equals:({item:e},t)=>e.getId()===(t==null?void 0:t.getId()),isExpanded:({tree:e,itemId:t})=>e.getState().expandedItems.includes(t),isDescendentOf:({item:e},t)=>{const n=e.getParent();return!!((n==null?void 0:n.getId())===t||n!=null&&n.isDescendentOf(t))},isFocused:({tree:e,item:t,itemId:n})=>e.getState().focusedItem===n||e.getState().focusedItem===null&&t.getItemMeta().index===0,isFolder:({tree:e,item:t})=>t.getItemMeta().level===-1||e.getConfig().isItemFolder(t),getItemName:({tree:e,item:t})=>e.getConfig().getItemName(t),setFocused:({tree:e,itemId:t})=>{e.applySubStateUpdate("focusedItem",t)},primaryAction:({tree:e,item:t})=>{var n,s;return(s=(n=e.getConfig()).onPrimaryAction)===null||s===void 0?void 0:s.call(n,t)},getParent:({tree:e,item:t})=>t.getItemMeta().parentId?e.getItemInstance(t.getItemMeta().parentId):void 0,getIndexInParent:({item:e})=>e.getItemMeta().posInSet,getChildren:({tree:e,itemId:t})=>e.retrieveChildrenIds(t).map(n=>e.getItemInstance(n)),getTree:({tree:e})=>e,getItemAbove:({tree:e,item:t})=>e.getItems()[t.getItemMeta().index-1],getItemBelow:({tree:e,item:t})=>e.getItems()[t.getItemMeta().index+1]},hotkeys:{focusNextItem:{hotkey:"ArrowDown",canRepeat:!0,preventDefault:!0,isEnabled:e=>{var t,n;return!((n=(t=e.isSearchOpen)===null||t===void 0?void 0:t.call(e))!==null&&n!==void 0&&n)&&!e.getState().dnd},handler:(e,t)=>{t.focusNextItem(),t.updateDomFocus()}},focusPreviousItem:{hotkey:"ArrowUp",canRepeat:!0,preventDefault:!0,isEnabled:e=>{var t,n;return!((n=(t=e.isSearchOpen)===null||t===void 0?void 0:t.call(e))!==null&&n!==void 0&&n)&&!e.getState().dnd},handler:(e,t)=>{t.focusPreviousItem(),t.updateDomFocus()}},expandOrDown:{hotkey:"ArrowRight",canRepeat:!0,handler:(e,t)=>{const n=t.getFocusedItem();n.isExpanded()||!n.isFolder()?(t.focusNextItem(),t.updateDomFocus()):n.expand()}},collapseOrUp:{hotkey:"ArrowLeft",canRepeat:!0,handler:(e,t)=>{var n;const s=t.getFocusedItem();(!s.isExpanded()||!s.isFolder())&&s.getItemMeta().level!==0?((n=s.getParent())===null||n===void 0||n.setFocused(),t.updateDomFocus()):s.collapse()}},focusFirstItem:{hotkey:"Home",handler:(e,t)=>{var n;(n=t.getItems()[0])===null||n===void 0||n.setFocused(),t.updateDomFocus()}},focusLastItem:{hotkey:"End",handler:(e,t)=>{var n;(n=t.getItems()[t.getItems().length-1])===null||n===void 0||n.setFocused(),t.updateDomFocus()}}}},Y=(e,t,n)=>{const s={};return[s,()=>{const o=n(s);e:for(let a=0;a<e.length;a++){const d=e[a][t];if(!d)continue e;t:for(const[m,f]of Object.entries(d)){if(!f)continue t;const c=s[m];s[m]=(...g)=>f(Object.assign(Object.assign({},o),{prev:c}),...g)}}}]},Z=e=>{var t;const n=e==null?void 0:e.map(s=>s.key);for(const s of e??[]){const i=(t=s.deps)===null||t===void 0?void 0:t.find(o=>!(n!=null&&n.includes(o)));if(i)throw j(`${s.key} needs ${i}`)}},ee=e=>(t,n)=>{var s,i;return n.key&&(!((s=t.overwrites)===null||s===void 0)&&s.includes(n.key))?1:t.key&&(!((i=n.overwrites)===null||i===void 0)&&i.includes(t.key))?-1:e.indexOf(t)-e.indexOf(n)},te=(e=[])=>e.sort(ee(e)),ne=e=>{var t,n,s,i;const o=(t=e.instanceBuilder)!==null&&t!==void 0?t:Y,a=[X,...te(e.features)];Z(a);const d=[...a],[m,f]=o(d,"treeInstance",r=>({tree:r}));let c=a.reduce((r,u)=>{var l,I;return(I=(l=u.getInitialState)===null||l===void 0?void 0:l.call(u,r,m))!==null&&I!==void 0?I:r},(s=(n=e.initialState)!==null&&n!==void 0?n:e.state)!==null&&s!==void 0?s:{}),g=a.reduce((r,u)=>{var l,I;return(I=(l=u.getDefaultConfig)===null||l===void 0?void 0:l.call(u,r,m))!==null&&I!==void 0?I:r},e);const x=a.reduce((r,u)=>Object.assign(Object.assign({},r),u.stateHandlerNames),{});let v;const h={current:{}},S={};let b=[];const F={},M={};let w={};const T={},D=()=>{b=[],w={};const[r,u]=o(d,"itemInstance",l=>({item:l,tree:m,itemId:g.rootItemId}));u(),S[g.rootItemId]=r,w[g.rootItemId]={itemId:g.rootItemId,index:-1,parentId:null,level:-1,posInSet:0,setSize:1};for(const l of m.getItemsMeta())if(w[l.itemId]=l,S[l.itemId])b.push(S[l.itemId]);else{const[I,y]=o(d,"itemInstance",p=>({item:p,tree:m,itemId:l.itemId}));y(),S[l.itemId]=I,b.push(I)}},k=r=>{for(const u of a)r(u)},W={key:"main",treeInstance:{getState:()=>c,setState:({},r)=>{var u;(u=g.setState)===null||u===void 0||u.call(g,c)},applySubStateUpdate:({},r,u)=>{c[r]=typeof u=="function"?u(c[r]):u;const l=g[x[r]];l==null||l(c[r])},rebuildTree:()=>{var r;D(),(r=g.setState)===null||r===void 0||r.call(g,c)},getConfig:()=>g,setConfig:(r,u)=>{var l,I,y;const p=typeof u=="function"?u(g):u,V=((l=p.state)===null||l===void 0?void 0:l.expandedItems)&&((I=p.state)===null||I===void 0?void 0:I.expandedItems)!==c.expandedItems;g=p,p.state&&(c=Object.assign(Object.assign({},c),p.state)),V&&(D(),(y=g.setState)===null||y===void 0||y.call(g,c))},getItemInstance:({},r)=>S[r],getItems:()=>b,registerElement:({},r)=>{v!==r&&(v&&!r?k(u=>{var l;return(l=u.onTreeUnmount)===null||l===void 0?void 0:l.call(u,m,v)}):!v&&r&&k(u=>{var l;return(l=u.onTreeMount)===null||l===void 0?void 0:l.call(u,m,r)}),v=r)},getElement:()=>v,getDataRef:()=>h,getHotkeyPresets:()=>T},itemInstance:{registerElement:({itemId:r,item:u},l)=>{if(F[r]===l)return;const I=F[r];I&&!l?k(y=>{var p;return(p=y.onItemUnmount)===null||p===void 0?void 0:p.call(y,u,I,m)}):!I&&l&&k(y=>{var p;return(p=y.onItemMount)===null||p===void 0?void 0:p.call(y,u,l,m)}),F[r]=l},getElement:({itemId:r})=>F[r],getDataRef:({itemId:r})=>{var u;return(u=M[r])!==null&&u!==void 0?u:M[r]={current:{}}},getItemMeta:({itemId:r})=>w[r]}};d.unshift(W);for(const r of d)Object.assign(T,(i=r.hotkeys)!==null&&i!==void 0?i:{});return f(),D(),m},se={key:"selection",getInitialState:e=>Object.assign({selectedItems:[]},e),getDefaultConfig:(e,t)=>Object.assign({setSelectedItems:_("selectedItems",t)},e),stateHandlerNames:{selectedItems:"setSelectedItems"},treeInstance:{setSelectedItems:({tree:e},t)=>{e.applySubStateUpdate("selectedItems",t)},getSelectedItems:({tree:e})=>e.getState().selectedItems.map(e.getItemInstance)},itemInstance:{select:({tree:e,itemId:t})=>{const{selectedItems:n}=e.getState();e.setSelectedItems(n.includes(t)?n:[...n,t])},deselect:({tree:e,itemId:t})=>{const{selectedItems:n}=e.getState();e.setSelectedItems(n.filter(s=>s!==t))},isSelected:({tree:e,itemId:t})=>{const{selectedItems:n}=e.getState();return n.includes(t)},selectUpTo:({tree:e,item:t},n)=>{const s=t.getItemMeta().index,i=e.getFocusedItem().getItemMeta().index,[o,a]=s<i?[s,i]:[i,s],d=e.getItems().slice(o,a+1).map(c=>c.getItemMeta().itemId);if(!n){e.setSelectedItems(d);return}const{selectedItems:m}=e.getState(),f=[...new Set([...m,...d])];e.setSelectedItems(f)},toggleSelect:({item:e})=>{e.isSelected()?e.deselect():e.select()},getProps:({tree:e,item:t,prev:n})=>Object.assign(Object.assign({},n==null?void 0:n()),{"aria-selected":t.isSelected()?"true":"false",onClick:s=>{var i,o;s.shiftKey?t.selectUpTo(s.ctrlKey||s.metaKey):s.ctrlKey||s.metaKey?t.toggleSelect():e.setSelectedItems([t.getItemMeta().itemId]),(o=(i=n==null?void 0:n())===null||i===void 0?void 0:i.onClick)===null||o===void 0||o.call(i,s)}})},hotkeys:{toggleSelectedItem:{hotkey:"Control+Space",preventDefault:!0,handler:(e,t)=>{t.getFocusedItem().toggleSelect()}},selectUpwards:{hotkey:"Shift+ArrowUp",handler:(e,t)=>{const n=t.getFocusedItem(),s=n.getItemAbove();s&&(n.isSelected()&&s.isSelected()?n.deselect():s.select(),s.setFocused(),t.updateDomFocus())}},selectDownwards:{hotkey:"Shift+ArrowDown",handler:(e,t)=>{const n=t.getFocusedItem(),s=n.getItemBelow();s&&(n.isSelected()&&s.isSelected()?n.deselect():s.select(),s.setFocused(),t.updateDomFocus())}},selectAll:{hotkey:"Control+a",preventDefault:!0,handler:(e,t)=>{t.setSelectedItems(t.getItems().map(n=>n.getId()))}}}},K={Letter:/^[a-z]$/,LetterOrNumber:/^[a-z0-9]$/,Plus:/^\+$/,Space:/^ $/},oe=(e,t,n)=>{const s=n.hotkey.toLowerCase().split("+"),i=s.every(d=>d in K?[...e].some(m=>K[d].test(m)):e.has(d)),o=!n.isEnabled||n.isEnabled(t),a=e.size===s.length;return i&&o&&a},ae=(e,t,n,s)=>{var i;return(i=Object.entries(Object.assign(Object.assign({},n),s)).find(([,o])=>oe(e,t,o)))===null||i===void 0?void 0:i[0]},ie={key:"hotkeys-core",onTreeMount:(e,t)=>{const n=e.getDataRef(),s=o=>{var a,d,m,f,c;const g=o.key.toLowerCase();(a=(c=n.current).pressedKeys)!==null&&a!==void 0||(c.pressedKeys=new Set);const x=!n.current.pressedKeys.has(g);n.current.pressedKeys.add(g);const v=ae(n.current.pressedKeys,e,e.getHotkeyPresets(),e.getConfig().hotkeys);if(!v)return;const h=Object.assign(Object.assign({},e.getHotkeyPresets()[v]),(d=e.getConfig().hotkeys)===null||d===void 0?void 0:d[v]);h&&(!h.allowWhenInputFocused&&o.target instanceof HTMLInputElement||!h.canRepeat&&!x||(h.preventDefault&&o.preventDefault(),h.handler(o,e),(f=(m=e.getConfig()).onTreeHotkey)===null||f===void 0||f.call(m,v,o)))},i=o=>{var a,d;(a=(d=n.current).pressedKeys)!==null&&a!==void 0||(d.pressedKeys=new Set),n.current.pressedKeys.delete(o.key.toLowerCase())};t.addEventListener("keydown",s),document.addEventListener("keyup",i),n.current.keydownHandler=s,n.current.keyupHandler=i},onTreeUnmount:(e,t)=>{const n=e.getDataRef();n.current.keyupHandler&&(document.removeEventListener("keyup",n.current.keyupHandler),delete n.current.keyupHandler),n.current.keydownHandler&&(t.removeEventListener("keydown",n.current.keydownHandler),delete n.current.keydownHandler)}};var A=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function d(c){try{f(s.next(c))}catch(g){a(g)}}function m(c){try{f(s.throw(c))}catch(g){a(g)}}function f(c){c.done?o(c.value):i(c.value).then(d,m)}f((s=s.apply(e,t||[])).next())})};const P="sync dataLoader returned promise",re={key:"sync-data-loader",getInitialState:e=>Object.assign({loadingItemData:[],loadingItemChildrens:[]},e),getDefaultConfig:(e,t)=>Object.assign({setLoadingItemData:_("loadingItemData",t),setLoadingItemChildrens:_("loadingItemChildrens",t)},e),stateHandlerNames:{loadingItemData:"setLoadingItemData",loadingItemChildrens:"setLoadingItemChildrens"},treeInstance:{waitForItemDataLoaded:()=>A(void 0,void 0,void 0,function*(){}),waitForItemChildrenLoaded:()=>A(void 0,void 0,void 0,function*(){}),retrieveItemData:({tree:e},t)=>{const n=e.getConfig().dataLoader.getItem(t);if(typeof n=="object"&&"then"in n)throw j(P);return n},retrieveChildrenIds:({tree:e},t)=>{const n=e.getConfig().dataLoader.getChildren(t);if(typeof n=="object"&&"then"in n)throw j(P);return n}},itemInstance:{isLoading:()=>!1}},de=e=>{const[t]=E.useState(()=>({current:ne(e)})),[n,s]=E.useState(()=>t.current.getState());return t.current.setConfig(i=>Object.assign(Object.assign(Object.assign({},i),e),{state:Object.assign(Object.assign({},n),e.state),setState:o=>{var a;s(o),(a=e.setState)===null||a===void 0||a.call(e,o)}})),t.current};var O={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var R;function le(){return R||(R=1,function(e){(function(){var t={}.hasOwnProperty;function n(){for(var o="",a=0;a<arguments.length;a++){var d=arguments[a];d&&(o=i(o,s(d)))}return o}function s(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return n.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var a="";for(var d in o)t.call(o,d)&&o[d]&&(a=i(a,d));return a}function i(o,a){return a?o?o+" "+a:o+a:o}e.exports?(n.default=n,e.exports=n):window.classNames=n})()}(O)),O.exports}var ce=le();const ue=G(ce),B=()=>{const e=de({initialState:{expandedItems:["folder-1"]},rootItemId:"folder",getItemName:t=>t.getItemData(),isItemFolder:t=>!t.getItemData().endsWith("item"),dataLoader:{getItem:t=>t,getChildren:t=>[`${t}-1`,`${t}-2`,`${t}-3`,`${t}-1item`,`${t}-2item`]},indent:20,features:[re,se,ie]});return L.jsx("div",{...e.getContainerProps(),className:"tree",children:e.getItems().map(t=>E.createElement("button",{...t.getProps(),key:t.getId(),style:{paddingLeft:`${t.getItemMeta().level*20}px`}},L.jsx("div",{className:ue("treeitem",{focused:t.isFocused(),expanded:t.isExpanded(),selected:t.isSelected(),folder:t.isFolder()}),children:t.getItemName()})))})};B.__docgenInfo={description:"",methods:[],displayName:"FileTree"};const fe={title:"React/General/FileTree Example",component:B,tags:["autodocs"]},C={args:{}};var U,$,z;C.parameters={...C.parameters,docs:{...(U=C.parameters)==null?void 0:U.docs,source:{originalSource:`{
  args: {}
}`,...(z=($=C.parameters)==null?void 0:$.docs)==null?void 0:z.source}}};const Ie=["Simple"];export{C as Simple,Ie as __namedExportsOrder,fe as default};
